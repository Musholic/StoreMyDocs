<div class="file-list-and-categories">
  <div class="category-filter-panel">
    <mat-divider></mat-divider>
    <div class="categoryExpand">
      <span class="example-spacer"></span>
      <button (click)="isCategoryPanelExpanded = !isCategoryPanelExpanded" mat-icon-button>
        <mat-icon *ngIf="isCategoryPanelExpanded">arrow_back</mat-icon>
        <mat-icon *ngIf="!isCategoryPanelExpanded">arrow_forward</mat-icon>
      </button>
    </div>
    <div class="categoryFilterHeader">
      <mat-icon>category</mat-icon>
      &nbsp;
      <span *ngIf="isCategoryPanelExpanded">Categories</span>
    </div>
    <mat-tree *ngIf="isCategoryPanelExpanded" [dataSource]="categoryDataSource" [treeControl]="categoryTreeControl"
              class="categoryFilters">
      <mat-tree-node *matTreeNodeDef="let node" matTreeNodeToggle>
        <mat-chip-option (selectionChange)="filterByCategory(node,$event.selected)"
                         [selected]="isCategorySelected(node)"
                         class="categoryName"> {{node.name}} </mat-chip-option>
      </mat-tree-node>
      <mat-nested-tree-node *matTreeNodeDef="let node; when: categoryHasChild">
        <div class="mat-tree-node">
          <button mat-icon-button matTreeNodeToggle>
            <mat-icon class="mat-icon-rtl-mirror">
              {{categoryTreeControl.isExpanded(node) ? 'expand_more' : 'chevron_right'}}
            </mat-icon>
          </button>
          <mat-chip-option (selectionChange)="filterByCategory(node,$event.selected)"
                           [selected]="isCategorySelected(node)"
                           class="categoryName"> {{node.name}} </mat-chip-option>
        </div>
        <div [hidden]="!categoryTreeControl.isExpanded(node)" role="group">
          <ng-container matTreeNodeOutlet></ng-container>
        </div>
      </mat-nested-tree-node>
    </mat-tree>
  </div>
  <mat-divider [vertical]="true"></mat-divider>
  <div class="files-list">
    <mat-form-field class="nameFilter">
      <mat-label>Filter</mat-label>
      <input (keyup)="refreshFilter()" [(ngModel)]="nameFilter" matInput placeholder="Filter">
    </mat-form-field>
    <table [dataSource]="fileDataSource" aria-label="List of uploaded files" mat-table matSort>
      <ng-container matColumnDef="name">
        <th *matHeaderCellDef mat-header-cell mat-sort-header> Name</th>
        <td *matCellDef="let element" mat-cell><img [ngSrc]="element.iconLink" alt="file icon" height="16" width="16">
          &nbsp; {{element.name}} </td>
      </ng-container>

      <ng-container matColumnDef="date">
        <th *matHeaderCellDef mat-header-cell mat-sort-header> Date</th>
        <td *matCellDef="let element" mat-cell> {{ element.modifiedTime | date:'medium' }}</td>
      </ng-container>

      <ng-container matColumnDef="category">
        <th *matHeaderCellDef mat-header-cell> Category</th>
        <td *matCellDef="let element" mat-cell>
          <mat-chip-listbox [multiple]="true">
            <mat-chip-option (selectionChange)="filterByCategory(cat, $event.selected)" *ngFor="let cat of getCategories(element)"
                             [selected]="isCategorySelected(cat)">{{cat.name}}</mat-chip-option>
          </mat-chip-listbox>
        </td>
      </ng-container>

      <ng-container matColumnDef="size">
        <th *matHeaderCellDef mat-header-cell mat-sort-header> Size</th>
        <td *matCellDef="let element" mat-cell> {{element.size | filesize}} </td>
      </ng-container>

      <ng-container matColumnDef="actions">
        <th *matHeaderCellDef mat-header-cell></th>
        <td *matCellDef="let element" [matMenuTriggerFor]="menu" mat-cell mat-ripple>
          <mat-icon>more_vert</mat-icon>
          <mat-menu #menu="matMenu">
            <a [href]="element.dlLink" mat-menu-item>
              <mat-icon>download</mat-icon>
              <span>Download</span>
            </a>
            <button (click)="setCategory(element)" class="set-category-file" mat-menu-item>
              <mat-icon>category</mat-icon>
              <span>Set category</span>
            </button>
            <button (click)="trashFile(element)" class="force-warn trash-file" mat-menu-item>
              <mat-icon class="force-warn">delete</mat-icon>
              <span>Trash</span>
            </button>
          </mat-menu>
        </td>
      </ng-container>

      <tr *matHeaderRowDef="displayedColumns" mat-header-row></tr>
      <tr *matRowDef="let row; columns: displayedColumns;" mat-row></tr>
      <tr *matNoDataRow class="mat-row">
        <td class="mat-cell not_found" colspan="5">No document matching the file name "{{nameFilter}}"</td>
      </tr>
    </table>
  </div>
</div>
